<!DOCTYPE html>
<html lang="en">
<head>
    <!-- IMPORTANT: Make sure your text editor saves this file with UTF-8 Encoding! -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCIE 1012 Chapter 4 Quiz</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="password"] { width: 100%; padding: 8px; box-sizing: border-box; }
        input[type="radio"] { margin-right: 5px; vertical-align: middle;}
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #error-message, #password-error, #login-error { color: red; font-size: 1.2em; text-align: center; }
        #success-message { color: green; font-size: 1.2em; text-align: center; }
        #results, #review-section, #submission-copy { margin-top: 20px; text-align: left; border: 1px solid #ccc; padding: 15px; border-radius: 5px; background-color: #f9f9f9;}
        #password-section, #login-section { text-align: center; max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;}
        #password-section input[type="password"], #login-section input[type="text"], #login-section input[type="password"] { width: calc(100% - 18px); }
        .question-result { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        #download-pdf, #download-response { margin-top: 10px; }
        #score { font-weight: bold; text-align: center; color: green; font-size: 1.4em; margin-top: 20px; }
        #review-section h2, #submission-copy h2, #results h1 { margin-bottom: 15px; text-align: center; color: #007bff;}
        #review-section button, #submission-copy button, #password-section button, #login-section button, #results button { margin-top: 15px; }
        .choices p { margin: 2px 0 2px 20px; }
        .form-group span { display: inline-block; margin-left: 3px; margin-right: 15px;}
    </style>
</head>
<body>
    <div id="login-section">
        <h1>Login to Access Quiz</h1>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" placeholder="Enter password" required>
        </div>
        <button onclick="checkLogin()">Login</button>
        <p id="login-error" class="hidden">Incorrect username or password. Please try again.</p>
    </div>

    <div id="quiz-form" class="hidden">
        <h1>MCIE 1012 Chapter 4 Quiz</h1>
        <form id="mcie-quiz-ch4" method="POST">
             <!-- Student Information -->
             <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="id_number">ID Number:</label>
                <input type="text" id="id_number" name="id_number" required>
            </div>
            <div class="form-group">
                <label for="section">Section:</label>
                <input type="text" id="section" name="section" required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <hr>
            <h2>Chapter 4 Questions</h2>

            <!-- MCIE Chapter 4 Multiple-Choice Questions -->
            <!-- ... Q1-31 ... -->
             <div class="form-group">
                <label>1. Which of the following is NOT considered an essential attribute of a state?</label>
                <input type="radio" name="q1" value="A" required><span>A) Defined territory</span><br>
                <input type="radio" name="q1" value="B"><span>B) Permanent population</span><br>
                <input type="radio" name="q1" value="C"><span>C) Effective government</span><br>
                <input type="radio" name="q1" value="D"><span>D) Homogeneous culture</span>
            </div>
            <div class="form-group">
                <label>2. Which theory views the state as an 'umpire' or 'referee' in society?</label>
                <input type="radio" name="q2" value="A" required><span>A) Marxism</span><br>
                <input type="radio" name="q2" value="B"><span>B) Pluralism</span><br>
                <input type="radio" name="q2" value="C"><span>C) Leviathan State</span><br>
                <input type="radio" name="q2" value="D"><span>D) Patriarchal State</span>
            </div>
            <div class="form-group">
                <label>3. What is the primary focus of the Leviathan state theory?</label>
                <input type="radio" name="q3" value="A" required><span>A) Promoting individual liberty</span><br>
                <input type="radio" name="q3" value="B"><span>B) Minimizing state intervention</span><br>
                <input type="radio" name="q3" value="C"><span>C) State self-aggrandizement</span><br>
                <input type="radio" name="q3" value="D"><span>D) Ensuring equality</span>
            </div>
            <div class="form-group">
                <label>4. Which theory views the state as an instrument of male power?</label>
                <input type="radio" name="q4" value="A" required><span>A) Pluralism</span><br>
                <input type="radio" name="q4" value="B"><span>B) Marxism</span><br>
                <input type="radio" name="q4" value="C"><span>C) Patriarchal State</span><br>
                <input type="radio" name="q4" value="D"><span>D) Leviathan State</span>
            </div>
            <div class="form-group">
                <label>5. Which of the following best describes a minimal state?</label>
                <input type="radio" name="q5" value="A" required><span>A) Extensive economic planning</span><br>
                <input type="radio" name="q5" value="B"><span>B) Large welfare programs</span><br>
                <input type="radio" name="q5" value="C"><span>C) Limited to protection and enforcement</span><br>
                <input type="radio" name="q5" value="D"><span>D) Comprehensive social control</span>
            </div>
            <div class="form-group">
                <label>6. What is the main goal of a developmental state?</label>
                <input type="radio" name="q6" value="A" required><span>A) Maintaining social order</span><br>
                <input type="radio" name="q6" value="B"><span>B) Promoting economic growth</span><br>
                <input type="radio" name="q6" value="C"><span>C) Ensuring equality</span><br>
                <input type="radio" name="q6" value="D"><span>D) Controlling all aspects of life</span>
            </div>
            <div class="form-group">
                <label>7. Which type of state emphasizes social restructuring and welfare programs?</label>
                <input type="radio" name="q7" value="A" required><span>A) Minimal State</span><br>
                <input type="radio" name="q7" value="B"><span>B) Developmental State</span><br>
                <input type="radio" name="q7" value="C"><span>C) Social Democratic State</span><br>
                <input type="radio" name="q7" value="D"><span>D) Totalitarian State</span>
            </div>
            <div class="form-group">
                <label>8. What is a key characteristic of a totalitarian state?</label>
                <input type="radio" name="q8" value="A" required><span>A) Limited government</span><br>
                <input type="radio" name="q8" value="B"><span>B) Protection of civil liberties</span><br>
                <input type="radio" name="q8" value="C"><span>C) Comprehensive state control</span><br>
                <input type="radio" name="q8" value="D"><span>D) Free market economy</span>
            </div>
            <div class="form-group">
                <label>9. Which approach to studying the state focuses on its role in international politics?</label>
                <input type="radio" name="q9" value="A" required><span>A) Idealist</span><br>
                <input type="radio" name="q9" value="B"><span>B) Functionalist</span><br>
                <input type="radio" name="q9" value="C"><span>C) Organizational</span><br>
                <input type="radio" name="q9" value="D"><span>D) International</span>
            </div>
            <div class="form-group">
                <label>10. Which term best describes an area that has been forcibly taken over by another state?</label>
                <input type="radio" name="q10" value="A" required><span>A) Pluralist State</span><br>
                <input type="radio" name="q10" value="B"><span>B) Totalitarian State</span><br>
                <input type="radio" name="q10" value="C"><span>C) Collectivized State</span><br>
                <input type="radio" name="q10" value="D"><span>D) Religious State</span>
            </div>
            <div class="form-group">
                <label>11. What is the primary function of government, in its broadest sense?</label>
                <input type="radio" name="q11" value="A" required><span>A) Wealth redistribution</span><br>
                <input type="radio" name="q11" value="B"><span>B) Maintaining ordered rule</span><br>
                <input type="radio" name="q11" value="C"><span>C) Promoting specific ideologies</span><br>
                <input type="radio" name="q11" value="D"><span>D) Ensuring total equality</span>
            </div>
            <div class="form-group">
                <label>12. Which two attributes are essential for a government to be stable and effective?</label>
                <input type="radio" name="q12" value="A" required><span>A) Wealth and power</span><br>
                <input type="radio" name="q12" value="B"><span>B) Military strength and popularity</span><br>
                <input type="radio" name="q12" value="C"><span>C) Authority and legitimacy</span><br>
                <input type="radio" name="q12" value="D"><span>D) Size and resources</span>
            </div>
            <div class="form-group">
                <label>13. In politics, what does legitimacy refer to?</label>
                <input type="radio" name="q13" value="A" required><span>A) The amount of military power a government holds</span><br>
                <input type="radio" name="q13" value="B"><span>B) The legal standing of a government</span><br>
                <input type="radio" name="q13" value="C"><span>C) Popular acceptance of a governing regime</span><br>
                <input type="radio" name="q13" value="D"><span>D) The economic output of a nation</span>
            </div>
            <div class="form-group">
                <label>14. What are the typical purposes of government?</label>
                <input type="radio" name="q14" value="A" required><span>A) Protecting its own sovereignty and enriching the rulers</span><br>
                <input type="radio" name="q14" value="B"><span>B) Granting rights to individuals and providing a platform to abuse them</span><br>
                <input type="radio" name="q14" value="C"><span>C) Self-preservation, regulating resources, managing conflicts, fulfilling aspirations, and protecting rights</span><br>
                <input type="radio" name="q14" value="D"><span>D) Managing conflicts between parties only</span>
            </div>
            <div class="form-group">
                <label>15. What is meant by citizenship?</label>
                <input type="radio" name="q15" value="A" required><span>A) Someone who has no freedom or rights</span><br>
                <input type="radio" name="q15" value="B"><span>B) An individual who is a permanent resident of another country</span><br>
                <input type="radio" name="q15" value="C"><span>C) An individual legally recognized as a member of a particular political community</span><br>
                <input type="radio" name="q15" value="D"><span>D) An individual whose parents belong to a state</span>
            </div>
            <div class="form-group">
                <label>16. How do theorists categorize citizenship?</label>
                <input type="radio" name="q16" value="A" required><span>A) Into different theories</span><br>
                <input type="radio" name="q16" value="B"><span>B) Liberal, communitarian, republican, and multicultural</span><br>
                <input type="radio" name="q16" value="C"><span>C) By different kinds of political parties</span><br>
                <input type="radio" name="q16" value="D"><span>D) Economic and political</span>
            </div>
            <div class="form-group">
                <label>17. What does citizenship in liberal thought emphasize?</label>
                <input type="radio" name="q17" value="A" required><span>A) What people feel compelled to do when acting rightly</span><br>
                <input type="radio" name="q17" value="B"><span>B) Individual liberty and rights</span><br>
                <input type="radio" name="q17" value="C"><span>C) Tolerance as a value that fosters mutual tolerance</span><br>
                <input type="radio" name="q17" value="D"><span>D) Individuals doing what they love in a lawful manner</span>
            </div>
            <div class="form-group">
                <label>18. What does citizenship in communitarian thought emphasize?</label>
                <input type="radio" name="q18" value="A" required><span>A) Individual freedom</span><br>
                <input type="radio" name="q18" value="B"><span>B) Community belonging and shared values</span><br>
                <input type="radio" name="q18" value="C"><span>C) Rights</span><br>
                <input type="radio" name="q18" value="D"><span>D) Uniform rights</span>
            </div>
            <div class="form-group">
                <label>19. What does citizenship in republican thought emphasize?</label>
                <input type="radio" name="q19" value="A" required><span>A) Freedom of human rights</span><br>
                <input type="radio" name="q19" value="B"><span>B) Emphasis on politics</span><br>
                <input type="radio" name="q19" value="C"><span>C) Civic participation and the common good</span><br>
                <input type="radio" name="q19" value="D"><span>D) Proficiency in speaking and writing</span>
            </div>
            <div class="form-group">
                <label>20. What does citizenship in multicultural thought emphasize?</label>
                <input type="radio" name="q20" value="A" required><span>A) Recognition that each person can bring their own culture</span><br>
                <input type="radio" name="q20" value="B"><span>B) Recognition of diversity and group rights</span><br>
                <input type="radio" name="q20" value="C"><span>C) The capacity to innovate and create a new generation</span><br>
                <input type="radio" name="q20" value="D"><span>D) Actions that promote observable good</span>
            </div>
             <div class="form-group">
                <label>21. What are the primary modes of acquiring and losing citizenship?</label>
                <input type="radio" name="q21" value="A" required><span>A) Having a large family and extensive connections</span><br>
                <input type="radio" name="q21" value="B"><span>B) Citizenship by birth and by naturalization</span><br>
                <input type="radio" name="q21" value="C"><span>C) Excelling in speaking and writing</span><br>
                <input type="radio" name="q21" value="D"><span>D) Being a good or bad teacher</span>
            </div>
            <div class="form-group">
                <label>22. What is statelessness?</label>
                <input type="radio" name="q22" value="A" required><span>A) The condition of lacking citizenship in any country and having no government to seek protection from</span><br>
                <input type="radio" name="q22" value="B"><span>B) Being in love with multiple people</span><br>
                <input type="radio" name="q22" value="C"><span>C) Having a government and excelling within it</span><br>
                <input type="radio" name="q22" value="D"><span>D) Having both a mother and a father</span>
            </div>
            <div class="form-group">
                <label>23. Which political theory emphasizes civic virtue and participation in public life?</label>
                <input type="radio" name="q23" value="A" required><span>A) Liberalism</span><br>
                <input type="radio" name="q23" value="B"><span>B) Communitarianism</span><br>
                <input type="radio" name="q23" value="C"><span>C) Republicanism</span><br>
                <input type="radio" name="q23" value="D"><span>D) Multiculturalism</span>
            </div>
            <div class="form-group">
                <label>24. Which citizenship theory is most likely to advocate for group-specific rights to address historical inequalities?</label>
                <input type="radio" name="q24" value="A" required><span>A) Liberalism</span><br>
                <input type="radio" name="q24" value="B"><span>B) Communitarianism</span><br>
                <input type="radio" name="q24" value="C"><span>C) Republicanism</span><br>
                <input type="radio" name="q24" value="D"><span>D) Multiculturalism</span>
            </div>
            <div class="form-group">
                <label>25. What does 'Jus Soli' refer to?</label>
                <input type="radio" name="q25" value="A" required><span>A) Citizenship by blood</span><br>
                <input type="radio" name="q25" value="B"><span>B) Citizenship by marriage</span><br>
                <input type="radio" name="q25" value="C"><span>C) Citizenship by birth in a territory</span><br>
                <input type="radio" name="q25" value="D"><span>D) Citizenship by naturalization</span>
            </div>
            <div class="form-group">
                <label>26. What does 'Jus Sanguinis' refer to?</label>
                <input type="radio" name="q26" value="A" required><span>A) Citizenship by naturalization</span><br>
                <input type="radio" name="q26" value="B"><span>B) Citizenship by birth in a territory</span><br>
                <input type="radio" name="q26" value="C"><span>C) Citizenship by blood</span><br>
                <input type="radio" name="q26" value="D"><span>D) Citizenship by marriage</span>
            </div>
            <div class="form-group">
                <label>27. Which of the following is NOT a common ground for denationalization?</label>
                <input type="radio" name="q27" value="A" required><span>A) Treason</span><br>
                <input type="radio" name="q27" value="B"><span>B) Having dual citizenship</span><br>
                <input type="radio" name="q27" value="C"><span>C) Committing a war crime</span><br>
                <input type="radio" name="q27" value="D"><span>D) Having an outstanding tax debt</span>
            </div>
            <div class="form-group">
                <label>28. What is dual citizenship?</label>
                <input type="radio" name="q28" value="A" required><span>A) The condition of having citizenship in two nations</span><br>
                <input type="radio" name="q28" value="B"><span>B) A government organized as a political or individual entity</span><br>
                <input type="radio" name="q28" value="C"><span>C) Low cognitive, affective, and evaluative capacity in people</span><br>
                <input type="radio" name="q28" value="D"><span>D) The state as a nucleus caring for social and legal interests</span>
            </div>
            <div class="form-group">
                <label>29. Which philosopher is best known for advocating the protection of natural rights and a limited state?</label>
                <input type="radio" name="q29" value="A" required><span>A) Thomas Hobbes</span><br>
                <input type="radio" name="q29" value="B"><span>B) John Locke</span><br>
                <input type="radio" name="q29" value="C"><span>C) Jean-Jacques Rousseau</span><br>
                <input type="radio" name="q29" value="D"><span>D) Karl Marx</span>
            </div>
            <div class="form-group">
                <label>30. In the context of defining the state, what does the 'organizational view' emphasize?</label>
                <input type="radio" name="q30" value="A" required><span>A) An ethical community underpinned by mutual sympathy</span><br>
                <input type="radio" name="q30" value="B"><span>B) The maintenance of social order</span><br>
                <input type="radio" name="q30" value="C"><span>C) The apparatus of government</span><br>
                <input type="radio" name="q30" value="D"><span>D) The state as a unit in international politics</span>
            </div>
            <div class="form-group">
                <label>31. What does a collectivized state refer to?</label>
                <input type="radio" name="q31" value="A" required><span>A) A state that prioritizes social and legal interests of all individuals</span><br>
                <input type="radio" name="q31" value="B"><span>B) An attempt to systematically understand morality</span><br>
                <input type="radio" name="q31" value="C"><span>C) A state where citizens are under its authority</span><br>
                <input type="radio" name="q31" value="D"><span>D) Bringing the entirety of economic life under state control</span>
            </div>

            <div class="form-group">
                <label>32. In parochial cultures, what is the role of citizens in the political sphere of their countries?</label>
                <input type="radio" name="q32" value="A" required><span>A) Low cognitive, affective, and evaluative orientation</span><br>
                <input type="radio" name="q32" value="B"><span>B) Being in power within the political situation</span><br>
                <input type="radio" name="q32" value="C"><span>C) Inability to gain political power in their state</span><br>
                <input type="radio" name="q32" value="D"><span>D) Citizens educated to suit the state's constitution</span><br> <!-- Corrected -->
            </div>

            <!-- ... Q33-56 ... -->
             <div class="form-group">
                <label>33. In subject cultures, there is a high cognitive, affective, and evaluative orientation toward:</label>
                <input type="radio" name="q33" value="A" required><span>A) Input objects</span><br>
                <input type="radio" name="q33" value="B"><span>B) Society</span><br>
                <input type="radio" name="q33" value="C"><span>C) Political system and policy outputs</span><br>
                <input type="radio" name="q33" value="D"><span>D) Individuals</span>
            </div>
            <div class="form-group">
                <label>34. The necessity of delivering this course stems from which of the following?</label>
                <input type="radio" name="q34" value="A" required><span>A) The need for a fuller, richer, and more subtle understanding and practice of citizenship</span><br>
                <input type="radio" name="q34" value="B"><span>B) The need for a better life</span><br>
                <input type="radio" name="q34" value="C"><span>C) The rights of human beings</span><br>
                <input type="radio" name="q34" value="D"><span>D) Advancements in information and communication technology</span>
            </div>
            <div class="form-group">
                <label>35. According to Sastry et al. (2011), what does 'one's right implies the other's duty' mean?</label>
                <input type="radio" name="q35" value="A" required><span>A) The government has a duty to protect human beings in its state</span><br>
                <input type="radio" name="q35" value="B"><span>B) Everyone has the right to speak and express their feelings</span><br>
                <input type="radio" name="q35" value="C"><span>C) Every right of an individual imposes a duty on others</span><br>
                <input type="radio" name="q35" value="D"><span>D) The state must care for the social and legal interests of all individuals</span>
            </div>
            <div class="form-group">
                <label>36. What action should be taken against someone who misuses their rights and affects the rights of others?</label>
                <input type="radio" name="q36" value="A" required><span>A) The government has a duty to take appropriate legal action to prevent such acts</span><br>
                <input type="radio" name="q36" value="B"><span>B) They are under government duty, and individuals can do nothing</span><br>
                <input type="radio" name="q36" value="C"><span>C) It's about their freedom</span><br>
                <input type="radio" name="q36" value="D"><span>D) Every right imposes a duty on others</span>
            </div>
            <div class="form-group">
                <label>37. Which of the following is NOT a necessary requirement to be a legal citizen?</label>
                <input type="radio" name="q37" value="A" required><span>A) Permanent population</span><br>
                <input type="radio" name="q37" value="B"><span>B) Sovereignty</span><br>
                <input type="radio" name="q37" value="C"><span>C) Recognition by the international community</span><br>
                <input type="radio" name="q37" value="D"><span>D) Territorial unit</span>
            </div>
            <div class="form-group">
                <label>38. The term 'state' has been used to refer to a range of concepts. Which of the following is one of them?</label>
                <input type="radio" name="q38" value="A" required><span>A) A philosophical idea</span><br>
                <input type="radio" name="q38" value="B"><span>B) An instrument of coercion</span><br>
                <input type="radio" name="q38" value="C"><span>C) A territorial unit</span><br>
                <input type="radio" name="q38" value="D"><span>D) All of the above</span>
            </div>
            <div class="form-group">
                <label>39. According to the International Encyclopedia of the Social Sciences (1961), what is political culture?</label>
                <input type="radio" name="q39" value="A" required><span>A) Norms of conduct between political actors in society</span><br>
                <input type="radio" name="q39" value="B"><span>B) The set of attitudes, beliefs, and sentiments that give order and meaning to a political process</span><br>
                <input type="radio" name="q39" value="C"><span>C) Norms of conduct among political actors</span><br>
                <input type="radio" name="q39" value="D"><span>D) The need for society to have more members who think about everyone</span>
            </div>
            <div class="form-group">
                <label>40. In social studies, what does the term 'government' mean?</label>
                <input type="radio" name="q40" value="A" required><span>A) It's all about money</span><br>
                <input type="radio" name="q40" value="B"><span>B) It's about who comes.Opening to power</span><br>
                <input type="radio" name="q40" value="C"><span>C) It's about politics and who is smarter</span><br>
                <input type="radio" name="q40" value="D"><span>D) To rule or control others</span>
            </div>
            <div class="form-group">
                <label>41. In politics, what does authority imply?</label>
                <input type="radio" name="q41" value="A" required><span>A) The ability to compel obedience</span><br>
                <input type="radio" name="q41" value="B"><span>B) What one ought to do in a particular instance</span><br>
                <input type="radio" name="q41" value="C"><span>C) That a person is powerful</span><br>
                <input type="radio" name="q41" value="D"><span>D) To lessen harm or evil and do good</span>
            </div>
            <div class="form-group">
                <label>42. Which element must an ideal society absolutely need?</label>
                <input type="radio" name="q42" value="A" required><span>A) The desire for human rights</span><br>
                <input type="radio" name="q42" value="B"><span>B) The need for peace</span><br>
                <input type="radio" name="q42" value="C"><span>C) The need for human unity</span><br>
                <input type="radio" name="q42" value="D"><span>D) Needs that cannot be secured by coercion</span>
            </div>
            <div class="form-group">
                <label>43. For what purpose should one exercise their rights?</label>
                <input type="radio" name="q43" value="A" required><span>A) The promotion of social good</span><br>
                <input type="radio" name="q43" value="B"><span>B) Gaining more respect from society</span><br>
                <input type="radio" name="q43" value="C"><span>C) Becoming more popular</span><br>
                <input type="radio" name="q43" value="D"><span>D) To lessen harm or evil and do good</span>
            </div>
            <div class="form-group">
                <label>44. According to the International Encyclopedia of the Social Sciences (1961), what is the meaning of politics?</label>
                <input type="radio" name="q44" value="A" required><span>A) Economic growth</span><br>
                <input type="radio" name="q44" value="B"><span>B) Social relationships</span><br>
                <input type="radio" name="q44" value="C"><span>C) Distribution of resources</span><br>
                <input type="radio" name="q44" value="D"><span>D) A set of attitudes, beliefs, and sentiments</span>
            </div>
            <div class="form-group">
                <label>45. What are the four issues Sastry et al. (2011) identify regarding the interplay between rights and duties?</label>
                <input type="radio" name="q45" value="A" required><span>A) One's right implies the other's duty, one's right implies a duty to recognize others' similar rights, one should exercise rights for social good, and the state must care for social and legal interests</span><br>
                <input type="radio" name="q45" value="B"><span>B) Care for family first, humans as social animals, honesty and loyalty, and care for the country</span><br>
                <input type="radio" name="q45" value="C"><span>C) Freedom to act, speak, and feel, identity from parents, actions with consequences, and family as a cornerstone</span><br>
                <input type="radio" name="q45" value="D"><span>D) Rights without punishment, karma, freedom as power, and self-acceptance</span>
            </div>
            <div class="form-group">
                <label>46. What types of political cultures did Almond and Verba (1963) construct?</label>
                <input type="radio" name="q46" value="A" required><span>A) Family, village, and state</span><br>
                <input type="radio" name="q46" value="B"><span>B) Economic, political, and humanitarian</span><br>
                <input type="radio" name="q46" value="C"><span>C) Parochial, subject, and participant cultures</span><br>
                <input type="radio" name="q46" value="D"><span>D) Rights, freedom, and responsibility</span>
            </div>
            <div class="form-group">
                <label>47. What is another name for Social Democratic States?</label>
                <input type="radio" name="q47" value="A" required><span>A) Minimal</span><br>
                <input type="radio" name="q47" value="B"><span>B) Welfare</span><br>
                <input type="radio" name="q47" value="C"><span>C) Capitalist</span><br>
                <input type="radio" name="q47" value="D"><span>D) Patriarchal</span>
            </div>
            <div class="form-group">
                <label>48. When one has no affiliation with any state, they are said to be:</label>
                <input type="radio" name="q48" value="A" required><span>A) Stateful</span><br>
                <input type="radio" name="q48" value="B"><span>B) Full of power</span><br>
                <input type="radio" name="q48" value="C"><span>C) A citizen</span><br>
                <input type="radio" name="q48" value="D"><span>D) Stateless</span>
            </div>
            <div class="form-group">
                <label>49. A state has all of the following basic elements except one. Which is it?</label>
                <input type="radio" name="q49" value="A" required><span>A) Recognition</span><br>
                <input type="radio" name="q49" value="B"><span>B) Government</span><br>
                <input type="radio" name="q49" value="C"><span>C) Population</span><br>
                <input type="radio" name="q49" value="D"><span>D) A sea</span>
            </div>
            <div class="form-group">
                <label>50. The power to govern is exercised through:</label>
                <input type="radio" name="q50" value="A" required><span>A) The government</span><br>
                <input type="radio" name="q50" value="B"><span>B) The citizens</span><br>
                <input type="radio" name="q50" value="C"><span>C) International law</span><br>
                <input type="radio" name="q50" value="D"><span>D) A constitution</span>
            </div>
            <div class="form-group">
                <label>51. Which statement is correct about the state?</label>
                <input type="radio" name="q51" value="A" required><span>A) It cannot be established without the consent of the people</span><br>
                <input type="radio" name="q51" value="B"><span>B) It is always secular</span><br>
                <input type="radio" name="q51" value="C"><span>C) It is always democratic</span><br>
                <input type="radio" name="q51" value="D"><span>D) Its primary goal is to become an economic giant</span>
            </div>
            <div class="form-group">
                <label>52. Which of the following is a characteristic of collectivism?</label>
                <input type="radio" name="q52" value="A" required><span>A) Freedom</span><br>
                <input type="radio" name="q52" value="B"><span>B) Private ownership</span><br>
                <input type="radio" name="q52" value="C"><span>C) Equality</span><br>
                <input type="radio" name="q52" value="D"><span>D) Market competition</span>
            </div>
            <div class="form-group">
                <label>53. According to the pluralist view, the state:</label>
                <input type="radio" name="q53" value="A" required><span>A) Cannot be seen apart from the economy</span><br>
                <input type="radio" name="q53" value="B"><span>B) Is a neutral arbiter between competing groups</span><br>
                <input type="radio" name="q53" value="C"><span>C) Is biased toward capitalism</span><br>
                <input type="radio" name="q53" value="D"><span>D) Is ruled by landlords</span>
            </div>
            <div class="form-group">
                <label>54. Which theory upholds an ethical community underpinned by mutual sympathy and 'universal altruism'?</label>
                <input type="radio" name="q54" value="A" required><span>A) International Approach</span><br>
                <input type="radio" name="q54" value="B"><span>B) Functional Approach</span><br>
                <input type="radio" name="q54" value="C"><span>C) Idealist Approach</span><br>
                <input type="radio" name="q54" value="D"><span>D) Organizational Approach</span>
            </div>
            <div class="form-group">
                <label>55. In the four elements of the state, which one states that 'the state should be free from foreign control of any kind'?</label>
                <input type="radio" name="q55" value="A" required><span>A) Defined Territory</span><br>
                <input type="radio" name="q55" value="B"><span>B) Sovereignty</span><br>
                <input type="radio" name="q55" value="C"><span>C) Population</span><br>
                <input type="radio" name="q55" value="D"><span>D) Government</span>
            </div>
            <div class="form-group">
                <label>56. According to Almond and Verba (1963), in parochial cultures, citizens have a low cognitive, affective, and evaluative orientation toward what?</label>
                <input type="radio" name="q56" value="A" required><span>A) Knowing everything about the political system</span><br>
                <input type="radio" name="q56" value="B"><span>B) Gaining a high education in political matters</span><br>
                <input type="radio" name="q56" value="C"><span>C) The political system</span><br>
                <input type="radio" name="q56" value="D"><span>D) High cognitive, affective, and evaluative orientation to the political system</span>
            </div>


            <button type="button" onclick="showReview()">Submit</button>
        </form>
        <div id="error-message" class="hidden">
            <p>Something went wrong. Please try again.</p>
        </div>
    </div>

    <div id="review-section" class="hidden">
        <h2>Review Your Answers</h2>
        <div id="review-content"></div>
        <button onclick="editForm()">Edit</button>
        <button onclick="downloadResponse()" id="download-response">Download My Response</button>
        <button onclick="confirmSubmission()">Confirm Submission</button>
    </div>

    <div id="submission-copy" class="hidden">
        <h2>Your Submitted Answers</h2>
        <div id="submission-content"></div>
        <button onclick="proceedToPassword()">Proceed</button>
    </div>

    <div id="password-section" class="hidden">
        <h1 id="success-message">Your response has been submitted</h1>
        <p>You can view your result (score) by entering the password.</p>
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
        <p id="password-error" class="hidden">Incorrect password. Please try again.</p>
    </div>

    <div id="results" class="hidden">
        <h1>Quiz Results</h1>
        <p id="student-info"></p>
        <div id="answers"></div>
        <p id="score"></p>
        <button id="download-pdf" onclick="downloadPDF()">Download Results PDF</button>
    </div>

    <script>
        let quizData = null;
        let formData = null;
        const { jsPDF } = window.jspdf;
        const TOTAL_QUESTIONS = 56; // Updated Total number of questions for Ch4

        // Valid login credentials
        const validCredentials = [
            { username: 'section19', password: '123' },
            { username: 'section20', password: '123' },
            { username: 'muzemuza', password: 'moh' },
            { username: 'section21', password: '123' }
            // Add more valid credentials as needed
        ];

        // Structure holding question texts and choices for Chapter 4
        // Corrected apostrophes (') in Q32 D, Q35, Q36 C, Q40 A/B/C, Q45 A, Q54, Q55
        const allQuestionsData = {
            q1: { text: "Which of the following is NOT considered an essential attribute of a state?", choices: { A: "Defined territory", B: "Permanent population", C: "Effective government", D: "Homogeneous culture" } },
            q2: { text: "Which theory views the state as an 'umpire' or 'referee' in society?", choices: { A: "Marxism", B: "Pluralism", C: "Leviathan State", D: "Patriarchal State" } },
            q3: { text: "What is the primary focus of the Leviathan state theory?", choices: { A: "Promoting individual liberty", B: "Minimizing state intervention", C: "State self-aggrandizement", D: "Ensuring equality" } },
            q4: { text: "Which theory views the state as an instrument of male power?", choices: { A: "Pluralism", B: "Marxism", C: "Patriarchal State", D: "Leviathan State" } },
            q5: { text: "Which of the following best describes a minimal state?", choices: { A: "Extensive economic planning", B: "Large welfare programs", C: "Limited to protection and enforcement", D: "Comprehensive social control" } },
            q6: { text: "What is the main goal of a developmental state?", choices: { A: "Maintaining social order", B: "Promoting economic growth", C: "Ensuring equality", D: "Controlling all aspects of life" } },
            q7: { text: "Which type of state emphasizes social restructuring and welfare programs?", choices: { A: "Minimal State", B: "Developmental State", C: "Social Democratic State", D: "Totalitarian State" } },
            q8: { text: "What is a key characteristic of a totalitarian state?", choices: { A: "Limited government", B: "Protection of civil liberties", C: "Comprehensive state control", D: "Free market economy" } },
            q9: { text: "Which approach to studying the state focuses on its role in international politics?", choices: { A: "Idealist", B: "Functionalist", C: "Organizational", D: "International" } },
            q10: { text: "Which term best describes an area that has been forcibly taken over by another state?", choices: { A: "Pluralist State", B: "Totalitarian State", C: "Collectivized State", D: "Religious State" } },
            q11: { text: "What is the primary function of government, in its broadest sense?", choices: { A: "Wealth redistribution", B: "Maintaining ordered rule", C: "Promoting specific ideologies", D: "Ensuring total equality" } },
            q12: { text: "Which two attributes are essential for a government to be stable and effective?", choices: { A: "Wealth and power", B: "Military strength and popularity", C: "Authority and legitimacy", D: "Size and resources" } },
            q13: { text: "In politics, what does legitimacy refer to?", choices: { A: "The amount of military power a government holds", B: "The legal standing of a government", C: "Popular acceptance of a governing regime", D: "The economic output of a nation" } },
            q14: { text: "What are the typical purposes of government?", choices: { A: "Protecting its own sovereignty and enriching the rulers", B: "Granting rights to individuals and providing a platform to abuse them", C: "Self-preservation, regulating resources, managing conflicts, fulfilling aspirations, and protecting rights", D: "Managing conflicts between parties only" } },
            q15: { text: "What is meant by citizenship?", choices: { A: "Someone who has no freedom or rights", B: "An individual who is a permanent resident of another country", C: "An individual legally recognized as a member of a particular political community", D: "An individual whose parents belong to a state" } },
            q16: { text: "How do theorists categorize citizenship?", choices: { A: "Into different theories", B: "Liberal, communitarian, republican, and multicultural", C: "By different kinds of political parties", D: "Economic and political" } },
            q17: { text: "What does citizenship in liberal thought emphasize?", choices: { A: "What people feel compelled to do when acting rightly", B: "Individual liberty and rights", C: "Tolerance as a value that fosters mutual tolerance", D: "Individuals doing what they love in a lawful manner" } },
            q18: { text: "What does citizenship in communitarian thought emphasize?", choices: { A: "Individual freedom", B: "Community belonging and shared values", C: "Rights", D: "Uniform rights" } },
            q19: { text: "What does citizenship in republican thought emphasize?", choices: { A: "Freedom of human rights", B: "Emphasis on politics", C: "Civic participation and the common good", D: "Proficiency in speaking and writing" } },
            q20: { text: "What does citizenship in multicultural thought emphasize?", choices: { A: "Recognition that each person can bring their own culture", B: "Recognition of diversity and group rights", C: "The capacity to innovate and create a new generation", D: "Actions that promote observable good" } },
            q21: { text: "What are the primary modes of acquiring and losing citizenship?", choices: { A: "Having a large family and extensive connections", B: "Citizenship by birth and by naturalization", C: "Excelling in speaking and writing", D: "Being a good or bad teacher" } },
            q22: { text: "What is statelessness?", choices: { A: "The condition of lacking citizenship in any country and having no government to seek protection from", B: "Being in love with multiple people", C: "Having a government and excelling within it", D: "Having both a mother and a father" } },
            q23: { text: "Which political theory emphasizes civic virtue and participation in public life?", choices: { A: "Liberalism", B: "Communitarianism", C: "Republicanism", D: "Multiculturalism" } },
            q24: { text: "Which citizenship theory is most likely to advocate for group-specific rights to address historical inequalities?", choices: { A: "Liberalism", B: "Communitarianism", C: "Republicanism", D: "Multiculturalism" } },
            q25: { text: "What does 'Jus Soli' refer to?", choices: { A: "Citizenship by blood", B: "Citizenship by marriage", C: "Citizenship by birth in a territory", D: "Citizenship by naturalization" } },
            q26: { text: "What does 'Jus Sanguinis' refer to?", choices: { A: "Citizenship by naturalization", B: "Citizenship by birth in a territory", C: "Citizenship by blood", D: "Citizenship by marriage" } },
            q27: { text: "Which of the following is NOT a common ground for denationalization?", choices: { A: "Treason", B: "Having dual citizenship", C: "Committing a war crime", D: "Having an outstanding tax debt" } },
            q28: { text: "What is dual citizenship?", choices: { A: "The condition of having citizenship in two nations", B: "A government organized as a political or individual entity", C: "Low cognitive, affective, and evaluative capacity in people", D: "The state as a nucleus caring for social and legal interests" } },
            q29: { text: "Which philosopher is best known for advocating the protection of natural rights and a limited state?", choices: { A: "Thomas Hobbes", B: "John Locke", C: "Jean-Jacques Rousseau", D: "Karl Marx" } },
            q30: { text: "In the context of defining the state, what does the 'organizational view' emphasize?", choices: { A: "An ethical community underpinned by mutual sympathy", B: "The maintenance of social order", C: "The apparatus of government", D: "The state as a unit in international politics" } },
            q31: { text: "What does a collectivized state refer to?", choices: { A: "A state that prioritizes social and legal interests of all individuals", B: "An attempt to systematically understand morality", C: "A state where citizens are under its authority", D: "Bringing the entirety of economic life under state control" } },
            q32: { text: "In parochial cultures, what is the role of citizens in the political sphere of their countries?", choices: { A: "Low cognitive, affective, and evaluative orientation", B: "Being in power within the political situation", C: "Inability to gain political power in their state", D: "Citizens educated to suit the state\\'s constitution" } }, // Corrected 's in D
            q33: { text: "In subject cultures, there is a high cognitive, affective, and evaluative orientation toward:", choices: { A: "Input objects", B: "Society", C: "Political system and policy outputs", D: "Individuals" } },
            q34: { text: "The necessity of delivering this course stems from which of the following?", choices: { A: "The need for a fuller, richer, and more subtle understanding and practice of citizenship", B: "The need for a better life", C: "The rights of human beings", D: "Advancements in information and communication technology" } },
            q35: { text: "According to Sastry et al. (2011), what does 'one\\'s right implies the other\\'s duty' mean?", choices: { A: "The government has a duty to protect human beings in its state", B: "Everyone has the right to speak and express their feelings", C: "Every right of an individual imposes a duty on others", D: "The state must care for the social and legal interests of all individuals" } },
            q36: { text: "What action should be taken against someone who misuses their rights and affects the rights of others?", choices: { A: "The government has a duty to take appropriate legal action to prevent such acts", B: "They are under government duty, and individuals can do nothing", C: "It\\'s about their freedom", D: "Every right imposes a duty on others" } },
            q37: { text: "Which of the following is NOT a necessary requirement to be a legal citizen?", choices: { A: "Permanent population", B: "Sovereignty", C: "Recognition by the international community", D: "Territorial unit" } },
            q38: { text: "The term 'state' has been used to refer to a range of concepts. Which of the following is one of them?", choices: { A: "A philosophical idea", B: "An instrument of coercion", C: "A territorial unit", D: "All of the above" } },
            q39: { text: "According to the International Encyclopedia of the Social Sciences (1961), what is political culture?", choices: { A: "Norms of conduct between political actors in society", B: "The set of attitudes, beliefs, and sentiments that give order and meaning to a political process", C: "Norms of conduct among political actors", D: "The need for society to have more members who think about everyone" } },
            q40: { text: "In social studies, what does the term 'government' mean?", choices: { A: "It\\'s all about money", B: "It\\'s about who comes.Opening to power", C: "It\\'s about politics and who is smarter", D: "To rule or control others" } },
            q41: { text: "In politics, what does authority imply?", choices: { A: "The ability to compel obedience", B: "What one ought to do in a particular instance", C: "That a person is powerful", D: "To lessen harm or evil and do good" } },
            q42: { text: "Which element must an ideal society absolutely need?", choices: { A: "The desire for human rights", B: "The need for peace", C: "The need for human unity", D: "Needs that cannot be secured by coercion" } },
            q43: { text: "For what purpose should one exercise their rights?", choices: { A: "The promotion of social good", B: "Gaining more respect from society", C: "Becoming more popular", D: "To lessen harm or evil and do good" } },
            q44: { text: "According to the International Encyclopedia of the Social Sciences (1961), what is the meaning of politics?", choices: { A: "Economic growth", B: "Social relationships", C: "Distribution of resources", D: "A set of attitudes, beliefs, and sentiments" } },
            q45: { text: "What are the four issues Sastry et al. (2011) identify regarding the interplay between rights and duties?", choices: { A: "One\\'s right implies the other\\'s duty, one\\'s right implies a duty to recognize others\\' similar rights, one should exercise rights for social good, and the state must care for social and legal interests", B: "Care for family first, humans as social animals, honesty and loyalty, and care for the country", C: "Freedom to act, speak, and feel, identity from parents, actions with consequences, and family as a cornerstone", D: "Rights without punishment, karma, freedom as power, and self-acceptance" } },
            q46: { text: "What types of political cultures did Almond and Verba (1963) construct?", choices: { A: "Family, village, and state", B: "Economic, political, and humanitarian", C: "Parochial, subject, and participant cultures", D: "Rights, freedom, and responsibility" } },
            q47: { text: "What is another name for Social Democratic States?", choices: { A: "Minimal", B: "Welfare", C: "Capitalist", D: "Patriarchal" } },
            q48: { text: "When one has no affiliation with any state, they are said to be:", choices: { A: "Stateful", B: "Full of power", C: "A citizen", D: "Stateless" } },
            q49: { text: "A state has all of the following basic elements except one. Which is it?", choices: { A: "Recognition", B: "Government", C: "Population", D: "A sea" } },
            q50: { text: "The power to govern is exercised through:", choices: { A: "The government", B: "The citizens", C: "International law", D: "A constitution" } },
            q51: { text: "Which statement is correct about the state?", choices: { A: "It cannot be established without the consent of the people", B: "It is always secular", C: "It is always democratic", D: "Its primary goal is to become an economic giant" } },
            q52: { text: "Which of the following is a characteristic of collectivism?", choices: { A: "Freedom", B: "Private ownership", C: "Equality", D: "Market competition" } },
            q53: { text: "According to the pluralist view, the state:", choices: { A: "Cannot be seen apart from the economy", B: "Is a neutral arbiter between competing groups", C: "Is biased toward capitalism", D: "Is ruled by landlords" } },
            q54: { text: "Which theory upholds an ethical community underpinned by mutual sympathy and 'universal altruism'?", choices: { A: "International Approach", B: "Functional Approach", C: "Idealist Approach", D: "Organizational Approach" } },
            q55: { text: "In the four elements of the state, which one states that 'the state should be free from foreign control of any kind'?", choices: { A: "Defined Territory", B: "Sovereignty", C: "Population", D: "Government" } },
            q56: { text: "According to Almond and Verba (1963), in parochial cultures, citizens have a low cognitive, affective, and evaluative orientation toward what?", choices: { A: "Knowing everything about the political system", B: "Gaining a high education in political matters", C: "The political system", D: "High cognitive, affective, and evaluative orientation to the political system" } }
        };

        // Correct answers mapped to letters for Chapter 4
        const correctAnswersMap = {
             q1: 'D',  q2: 'B',  q3: 'C',  q4: 'C',  q5: 'C',
             q6: 'B',  q7: 'C',  q8: 'C',  q9: 'D', q10: 'C',
            q11: 'B', q12: 'C', q13: 'C', q14: 'C', q15: 'C',
            q16: 'B', q17: 'B', q18: 'B', q19: 'C', q20: 'B',
            q21: 'B', q22: 'A', q23: 'C', q24: 'D', q25: 'C',
            q26: 'C', q27: 'D', q28: 'A', q29: 'B', q30: 'C',
            q31: 'D', q32: 'A', q33: 'C', q34: 'A', q35: 'C',
            q36: 'A', q37: 'C', q38: 'D', q39: 'B', q40: 'D',
            q41: 'A', q42: 'D', q43: 'A', q44: 'D', q45: 'A',
            q46: 'C', q47: 'B', q48: 'D', q49: 'D', q50: 'A',
            q51: 'A', q52: 'C', q53: 'B', q54: 'C', q55: 'B',
            q56: 'C'
        };


        // --- Functions (checkLogin, showReview, editForm, downloadResponse, confirmSubmission, etc.) ---
        // No changes needed in the function logic itself.

        function checkLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorMessage = document.getElementById('login-error');
            const loginSection = document.getElementById('login-section');
            const quizForm = document.getElementById('quiz-form');

            const isValid = validCredentials.some(cred =>
                cred.username === username && cred.password === password
            );

            if (isValid) {
                errorMessage.classList.add('hidden');
                loginSection.classList.add('hidden');
                quizForm.classList.remove('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function showReview() {
            const form = document.getElementById('mcie-quiz-ch4'); // Ensure correct form ID
            formData = new FormData(form);
            const data = Object.fromEntries(formData);

             let allAnswered = true;
             for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 if (!data[`q${i}`]) {
                     allAnswered = false;
                     break;
                 }
             }

             if (!data.name || !data.id_number || !data.section || !data.email || !data.phone || !allAnswered) {
                 alert('Please fill in all personal information and answer all questions before submitting.');
                 return;
             }

            quizData = {
                name: data.name,
                id_number: data.id_number,
                section: data.section,
                email: data.email,
                phone: data.phone,
                answers: {},
                questions: allQuestionsData
            };

            let reviewHTML = `
                <p><strong>Name:</strong> ${data.name}</p>
                <p><strong>ID Number:</strong> ${data.id_number}</p>
                <p><strong>Section:</strong> ${data.section}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Phone Number:</strong> ${data.phone}</p>
                <hr>
                <h3>Your Answers:</h3>
            `;

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const qKey = `q${i}`;
                const userAnswer = data[qKey];
                 if (!userAnswer) {
                    quizData.answers[qKey] = 'Not Answered';
                    reviewHTML += `<p><strong>Question ${i}:</strong> ${allQuestionsData[qKey].text}<br>Your answer: Not Answered</p>`;
                 } else {
                    quizData.answers[qKey] = userAnswer;
                    const questionInfo = allQuestionsData[qKey];
                    const answerText = questionInfo.choices[userAnswer];
                    reviewHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
                 }
            }

            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = reviewHTML;

            document.getElementById('quiz-form').classList.add('hidden');
            document.getElementById('review-section').classList.remove('hidden');
        }

        function editForm() {
            document.getElementById('review-section').classList.add('hidden');
            document.getElementById('quiz-form').classList.remove('hidden');
        }

        function downloadResponse() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 10;
            const lineHeight = 7;
            const questionSpacing = 5;
            const answerSpacing = 10;

            doc.setFontSize(16);
            doc.text('MCIE Chapter 4 Quiz Response', margin, y); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += lineHeight;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += lineHeight;
            doc.text(`Section: ${quizData.section}`, margin, y); y += lineHeight;
            doc.text(`Email: ${quizData.email}`, margin, y); y += lineHeight;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 10;

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const qKey = `q${i}`;
                const question = quizData.questions[qKey];
                const userAnswer = quizData.answers[qKey];
                const answerText = userAnswer !== 'Not Answered' ? question.choices[userAnswer] : 'Not Answered';

                const questionText = `Question ${i}: ${question.text}`;
                const questionLines = doc.splitTextToSize(questionText, doc.internal.pageSize.width - margin * 2);
                const neededHeight = (questionLines.length * 5) + questionSpacing + lineHeight + answerSpacing;

                 if (y + neededHeight > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                }

                doc.text(questionLines, margin, y);
                y += (questionLines.length * 5) + questionSpacing;

                 if (y > pageHeight - margin) { doc.addPage(); y = margin; }
                doc.text(`Your answer: ${userAnswer !== 'Not Answered' ? userAnswer + ') ' : ''}${answerText}`, margin, y);
                y += answerSpacing;
            }

            doc.save(`quiz_ch4_response_${quizData.id_number}.pdf`); // Updated filename
        }

        async function confirmSubmission() {
            if (confirm('Are you sure you want to submit your answers?')) {
                if (!quizData || !formData) {
                     console.error("Quiz data or form data is missing.");
                     alert("Error: Cannot submit. Please try filling the form again.");
                     editForm();
                     return;
                }

                const data = Object.fromEntries(formData);

                let score = 0;
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    const qKey = `q${i}`;
                    if (data[qKey] && data[qKey] === correctAnswersMap[qKey]) {
                        score++;
                    }
                }
                quizData.score = score;

                 const answersForSubmission = {};
                 for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                     answersForSubmission[`q${i}`] = data[`q${i}`] || 'Not Answered';
                 }

                const submissionData = {
                    quizTitle: "MCIE Chapter 4 Quiz", // Updated Title
                    name: data.name,
                    id_number: data.id_number,
                    section: data.section,
                    email: data.email,
                    phone: data.phone,
                    ...answersForSubmission,
                    score: score,
                    totalQuestions: TOTAL_QUESTIONS,
                    submittedAt: new Date().toISOString()
                };

                try {
                    const response = await fetch('https://formspree.io/f/myzeoejq', { // Use your Formspree endpoint
                        method: 'POST',
                        body: JSON.stringify(submissionData),
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const submissionContent = document.getElementById('submission-content');
                         let submissionHTML = `
                            <p><strong>Name:</strong> ${quizData.name}</p>
                            <p><strong>ID Number:</strong> ${quizData.id_number}</p>
                            <p><strong>Section:</strong> ${quizData.section}</p>
                            <p><strong>Email:</strong> ${quizData.email}</p>
                            <p><strong>Phone Number:</strong> ${quizData.phone}</p>
                            <hr>
                            <h3>Submitted Answers:</h3>
                        `;
                         for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                             const qKey = `q${i}`;
                             const questionInfo = quizData.questions[qKey];
                             const userAnswer = quizData.answers[qKey];
                             const answerText = userAnswer !== 'Not Answered' ? questionInfo.choices[userAnswer] : 'Not Answered';
                             submissionHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer !== 'Not Answered' ? userAnswer + ') ' : ''}${answerText}</p>`;
                         }
                        submissionContent.innerHTML = submissionHTML;

                        document.getElementById('review-section').classList.add('hidden');
                        document.getElementById('submission-copy').classList.remove('hidden');
                    } else {
                        const errorData = await response.json();
                        console.error('Formspree error:', errorData);
                        document.getElementById('error-message').innerHTML = `<p>Submission failed: ${errorData.error || 'Please try again.'}</p>`;
                        document.getElementById('error-message').classList.remove('hidden');
                        document.getElementById('review-section').classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Submission error:', error);
                    document.getElementById('error-message').innerHTML = `<p>An network error occurred during submission. Please check your connection and try again.</p>`;
                    document.getElementById('error-message').classList.remove('hidden');
                    document.getElementById('review-section').classList.add('hidden');
                }
            }
        }

        function proceedToPassword() {
            document.getElementById('submission-copy').classList.add('hidden');
            document.getElementById('password-section').classList.remove('hidden');
        }

        function checkPassword() {
            const passwordInput = document.getElementById('password').value;
            const correctPassword = 'password';
            const errorMessage = document.getElementById('password-error');
            const passwordSection = document.getElementById('password-section');
            const results = document.getElementById('results');

            if (passwordInput === correctPassword) {
                errorMessage.classList.add('hidden');
                passwordSection.classList.add('hidden');
                results.classList.remove('hidden');
                displayResults();
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function displayResults() {
            if (!quizData) {
                document.getElementById('results').innerHTML = '<p>Error: No quiz data found. Please complete the quiz first.</p>';
                return;
            }

             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey] ? allQuestionsData[qKey].choices[correctLetter] : 'N/A';
                 displayCorrectAnswers[qKey] = `${correctLetter} (${correctText})`;
             }

            document.getElementById('student-info').innerHTML = `<strong>Name:</strong> ${quizData.name}<br><strong>ID:</strong> ${quizData.id_number}<br><strong>Section:</strong> ${quizData.section}<br><strong>Email:</strong> ${quizData.email}<br><strong>Phone:</strong> ${quizData.phone}`;

            const answersDiv = document.getElementById('answers');
            let answersHTML = '<h3>Detailed Results:</h3>';

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = userAnswer !== 'Not Answered' ? question.choices[userAnswer] : 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];

                 answersHTML += `
                    <div class="question-result">
                        <p><strong>Question ${i}:</strong> ${question.text}</p>
                        <div class="choices">
                            <p>A) ${question.choices.A}</p>
                            <p>B) ${question.choices.B}</p>
                            <p>C) ${question.choices.C}</p>
                            <p>D) ${question.choices.D}</p>
                        </div>
                        <p>Your answer: ${userAnswer !== 'Not Answered' ? userAnswer + ') ' : ''}${userAnswerText} ${isCorrect ? '<span style="color:green; font-weight:bold;">(Correct)</span>' : '<span style="color:red; font-weight:bold;">(Incorrect)</span>'}</p>
                        <p>Correct answer: ${displayCorrectAnswers[qKey]}</p>
                    </div>
                `;
            }
            answersDiv.innerHTML = answersHTML;

            document.getElementById('score').textContent = `Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`;
        }

        function downloadPDF() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 10;
            const lineHeight = 7;
            const questionSpacing = 5;
            const answerSpacing = 7;
            const questionBlockSpacing = 10;

             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey] ? allQuestionsData[qKey].choices[correctLetter] : 'N/A';
                 displayCorrectAnswers[qKey] = `${correctLetter} (${correctText})`;
             }

            doc.setFontSize(16);
            doc.text('MCIE Chapter 4 Quiz Results', doc.internal.pageSize.width / 2, y, { align: 'center' }); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += lineHeight;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += lineHeight;
            doc.text(`Section: ${quizData.section}`, margin, y); y += lineHeight;
            doc.text(`Email: ${quizData.email}`, margin, y); y += lineHeight;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 10;

            doc.setFont('helvetica', 'bold');
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, doc.internal.pageSize.width / 2, y, { align: 'center' });
            y += 10;
            doc.setFont('helvetica', 'normal');

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const qKey = `q${i}`;
                const question = quizData.questions[qKey];
                const userAnswer = quizData.answers[qKey];
                const userAnswerText = userAnswer !== 'Not Answered' ? question.choices[userAnswer] : 'Not Answered';
                const isCorrect = userAnswer === correctAnswersMap[qKey];

                const questionText = `Question ${i}: ${question.text}`;
                const questionLines = doc.splitTextToSize(questionText, doc.internal.pageSize.width - margin * 2);

                const choicesHeight = 4 * 5 + answerSpacing;
                const answerLinesHeight = 2 * lineHeight + questionBlockSpacing;
                const neededHeight = (questionLines.length * 5) + questionSpacing + choicesHeight + answerLinesHeight;

                if (y + neededHeight > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                }

                doc.setFont('helvetica', 'bold');
                doc.text(questionLines, margin, y);
                y += (questionLines.length * 5) + questionSpacing;
                doc.setFont('helvetica', 'normal');

                if (y + choicesHeight + answerLinesHeight > pageHeight - margin) { doc.addPage(); y = margin; }

                doc.text(`Choices:`, margin, y); y += 5;
                doc.text(`  A) ${question.choices.A}`, margin, y); y += 5;
                doc.text(`  B) ${question.choices.B}`, margin, y); y += 5;
                doc.text(`  C) ${question.choices.C}`, margin, y); y += 5;
                doc.text(`  D) ${question.choices.D}`, margin, y); y += answerSpacing;

                doc.text(`Your answer: ${userAnswer !== 'Not Answered' ? userAnswer + ') ' : ''}${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, margin, y); y += lineHeight;
                doc.text(`Correct answer: ${displayCorrectAnswers[qKey]}`, margin, y); y += questionBlockSpacing;
            }

            if (y > pageHeight - margin) { doc.addPage(); y = margin; }
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, doc.internal.pageSize.width / 2, y, { align: 'center' });

            doc.save(`quiz_ch4_results_${quizData.id_number}.pdf`); // Updated filename
        }
    </script>
</body>
</html>